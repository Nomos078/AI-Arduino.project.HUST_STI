#include "myMath.h"

#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


/*

    char* my_intToStr(int num, char* buffer, int base)
    
    非标准C函数itoa的人工替代版
    
    功能   : 将整数按照指定的基数转换为字符串
    
    输入参数
        num    : 待转换的整数
        buffer : 要转换到的字符串
        base   : 转换的基数  如 10 则是转换为10进制数
        
    返回值 : 转换后的字符串首地址 若转换失败则为空
    
*/

char* my_intToStr(int num, char* buffer, int base)
{
    int curr = 0;
    int num_digits = 0;

    if (num == 0)
    {
        buffer[curr++] = '0';
        buffer[curr] = '\0';
        return buffer;
    }


    if (num < 0)
    {
        if (base == 10)
        {
            num_digits++;
            buffer[curr] = '-';
            curr++;
            num *= -1;
        }
        else
        {
            return NULL;
        }
    }

    num_digits += (int)floor(log(num) / log(base)) + 1;

    while (curr < num_digits)
    {
        int base_val = (int)pow(base, num_digits - 1 - curr);
        int num_val = num / base_val;
        char value;
        
        if (num_val < 10)
        {
            value = num_val + '0';
        }
        else
        {
            value = num_val + 'A' - 10;
        }
        buffer[curr] = value;

        curr++;
        num -= base_val * num_val;
    }
    buffer[curr] = '\0';
    return buffer;
}


const char CnStrElement[] = "零一二三四五六七八九十百千万负";
char* my_intToCnStr(int num, char* buffer, const char* unit)
{
    int curr = 0;
    int num_invert = 0;
    int num_length = 0;
    int singleDigit;

    if (num < 0)
    {
        buffer[curr++] = CnStrElement[28];
        buffer[curr++] = CnStrElement[29];
    }

    while (num)
    {
        num_invert *= 10;
        num_invert += num % 10;
        num /= 10;
        ++num_length;
    }

    if (num_length == 0)
    {
        buffer[curr++] = CnStrElement[0];
        buffer[curr++] = CnStrElement[1];
    }
    else
    {
        while (num_invert)
        {
            singleDigit = num_invert % 10 * 2;
            num_invert /= 10;
            --num_length;

            buffer[curr++] = CnStrElement[singleDigit + 0];
            buffer[curr++] = CnStrElement[singleDigit + 1];

            if (num_length != 0)
            {
                buffer[curr++] = CnStrElement[num_length % 5 * 2 + 18];
                buffer[curr++] = CnStrElement[num_length % 5 * 2 + 19];

                if (num_length / 5)
                {
                    buffer[curr++] = CnStrElement[26];
                    buffer[curr++] = CnStrElement[27];
                }
            }
        }
    }

    buffer[curr] = '\0';

    if (unit)
    {
        strcat(buffer,unit);
    }
    return buffer;
}
